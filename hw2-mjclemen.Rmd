---
title: "hw2-mjclemen"
author: "Mandy Clemente"
date: "October 2, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown - load the following libraries

```{r}
require(rgdal)
require(leaflet)
require(leaflet.extras)
require(dplyr)
require(readxl)
require(stringr)
require(tools)
```

# Read in csv file, take first 500 records, and apply title caps to the columns that will be used in the maps

```{r, geojson}
# Read in spatial data
crimes <- read.csv("Crime_Incidents_in_the_Last_30_Days.csv")
crimes.shortened <- crimes[1:500,]
crimes$METHOD <- str_to_title(crimes$METHOD)
crimes$SHIFT <- str_to_title(crimes$SHIFT)
crimes$START_DATE <- as.Date(crimes$START_DATE)
crimes$DISTRICT <- as.factor(crimes$DISTRICT)

# Read in geojson file
census.diversity <- readOGR("census-diversity.geojson")
```

# Map with a layer of points

```{r}
# Creating colored icons for each shift during which a crime occurred
icons <- awesomeIconList(
  Day = makeAwesomeIcon(icon = "certificate", library = "glyphicon", markerColor = "orange", iconColor = "black"),
  Evening = makeAwesomeIcon(icon = "bed", library = "glyphicon", markerColor = "blue", iconColor = "black"),
  Midnight = makeAwesomeIcon(icon = "cloud", library = "glyphicon", markerColor = "black", iconColor = "white")
)

# Use icons in map to show where the crimes occurred throughout the day and night
leaflet(data = crimes) %>%
  addProviderTiles(providers$Stamen.TonerHybrid) %>%
  addAwesomeMarkers(lng = ~LONGITUDE, lat = ~LATITUDE,  icon = ~icons[str_trim(SHIFT)], popup = ~SHIFT)
```

# Map with a layer of lines
```{r}
cancer.rates <- readOGR("./Cancer_Rates/Cancer_Rates.shp", layer = "Cancer_Rates", GDAL1_integer64_policy = TRUE)
head(cancer.rates@data)

# Create color palette to apply to polygons
color.palette <- colorNumeric("YlGnBu", NULL)

leaflet(data = cancer.rates) %>%
  addProviderTiles(providers$Stamen.Toner) %>%
  addPolylines(color = ~color.palette(cancer.rates$Breast_Can)) %>%
  addLegend(position = "topright", pal = color.palette, values = cancer.rates$Breast_Can, title = "Breast Cancer Rates")
```
# Map with a layer of polygons
```{r, geojson}

# Create color palette to apply to polygons
color.palette2 <- colorNumeric("Purples", NULL)

# Create map to show the population in different regions and then the hispanic population compared to total
leaflet(census.diversity) %>%
  addProviderTiles(providers$Esri.WorldGrayCanvas) %>%
  addPolygons(stroke = FALSE, smoothFactor = 0.3, fillOpacity = 1,
    fillColor = ~color.palette2(totpop10),
    popup = paste("Hispanic Population: ", census.diversity$hisppop_cy)) %>%
  addLegend(position = "topright", pal = color.palette2, values = ~totpop10, opacity = 1.0,
            title = "Total Population in Region")
```
# Map with a variable which changes of the color of the elements or the marker with an accompanying legend
```{r}

# Custom Palette
time.of.day.colors <- colorFactor(
  palette = c('red', 'yellow', 'blue'),
  levels = c('Day', 'Evening', 'Midnight'))

leaflet(data = crimes) %>%
  addProviderTiles(providers$Esri.WorldStreetMap) %>%
  addCircleMarkers(data = crimes,
                   lng = ~LONGITUDE,
                   lat = ~LATITUDE,
                   radius = 2,
                   color = ~time.of.day.colors(SHIFT)) %>%
  addLegend(position = 'topright',
            pal = time.of.day.colors,
            values = crimes$SHIFT,
            title = 'Time of Day')
```
# Map with functioning layersControl()
```{r}
leaflet(crimes) %>%
  # Two different base groups
  addProviderTiles(providers$OpenStreetMap, group = "Open Street") %>%
  addProviderTiles(providers$Stamen, group = "Stamen") %>%
  # Two different layers
  addCircles(lng = ~LONGITUDE, lat = ~LATITUDE, radius = crimes$PSA, stroke = F, group = "PSA", popup = ~PSA) %>%
  addCircles(data = crimes, lng = ~LONGITUDE, lat = ~LATITUDE,
    fill = F, weight = 3, color = "red", group = "Circle Outline") %>%
  # Layers control
  addLayersControl(
    baseGroups = c("Open Street", "Stamen"),
    overlayGroups = c("PSA", "Circle Outline"),
    options = layersControlOptions(collapsed = FALSE)
  )
```

