---
title: "hw2-mjclemen"
author: "Mandy Clemente"
date: "October 2, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown - load the following libraries

```{r}
require(rgdal)
require(leaflet)
require(leaflet.extras)
require(dplyr)
require(readxl)
require(stringr)
require(tools)
```

# Read in csv file, take first 500 records, and apply title caps to the columns that will be used in the maps

```{r}
# Read in spatial data
crimes <- read.csv("Crime_Incidents_in_the_Last_30_Days.csv")
crimes <- crimes[1:500,]
crimes$METHOD <- str_to_title(crimes$METHOD)
crimes$SHIFT <- str_to_title(crimes$SHIFT)
crimes$START_DATE <- as.Date(crimes$START_DATE)
crimes$DISTRICT <- as.factor(crimes$DISTRICT)
```

# Map with a layer of points

```{r}
# Creating colored icons for each shift during which a crime occurred
icons <- awesomeIconList(
  Day = makeAwesomeIcon(icon = "certificate", library = "glyphicon", markerColor = "orange", iconColor = "black"),
  Evening = makeAwesomeIcon(icon = "bed", library = "glyphicon", markerColor = "blue", iconColor = "black"),
  Midnight = makeAwesomeIcon(icon = "cloud", library = "glyphicon", markerColor = "black", iconColor = "white")
)

# Use icons in map to show where the crimes occurred throughout the day and night
leaflet(data = crimes) %>%
  addProviderTiles(providers$Stamen.TonerHybrid) %>%
  addAwesomeMarkers(lng = ~LONGITUDE, lat = ~LATITUDE,  icon = ~icons[str_trim(SHIFT)], popup = ~SHIFT)
```

# Map with a layer of lines
```{r}
color.by.census <- colorQuantile(palette = "Dark2", domain = crimes$CENSUS_TRACT, n = 7)

leaflet(data = crimes) %>%
  addProviderTiles(providers$Esri.NatGeoWorldMap) %>%
  addPolylines(lng = ~LONGITUDE, lat = ~LATITUDE,
               color = ~color.by.census(CENSUS_TRACT),
               weight = 2)
```
# Map with a layer of polygons
```{r}
crime.district <- colorQuantile(palette = c("red", "blue", "purple", "black", "orange", "pink", "green"),
                           domain = crimes$CENSUS_TRACT, n = 7)

leaflet(data = crimes) %>%
  addProviderTiles(providers$Stamen.Toner) %>%
  addPolygons(lng = ~LONGITUDE, lat = ~LATITUDE,
              fillColor = ~crime.district(CENSUS_TRACT),
              stroke = FALSE, smoothFactor = 0.2, fillOpacity = 1,
              popup = crimes$CENSUS_TRACT) %>%
  addLegend(pal = crime.district, values = ~CENSUS_TRACT, title = "Color by District:",
  position = "bottomright")
```
# Map with a variable which changes of the color of the elements or the marker with an accompanying legend
```{r}

# Custom Palette
time.of.day.colors <- colorFactor(
  palette = c('red', 'yellow', 'blue'),
  levels = c('Day', 'Evening', 'Midnight'))

leaflet(data = crimes) %>%
  addProviderTiles(providers$Esri.WorldStreetMap) %>%
  addCircleMarkers(data = crimes,
                   lng = ~LONGITUDE,
                   lat = ~LATITUDE,
                   radius = 2,
                   color = ~time.of.day.colors(SHIFT)) %>%
  addLegend(position = 'topright',
            pal = time.of.day.colors,
            values = crimes$SHIFT,
            title = 'Time of Day')
```
# Map with functioning layersControl()
```{r}
leaflet(crimes) %>%
  # Two different base groups
  addProviderTiles(providers$Thunderforest, group = "Thunderforest") %>%
  addProviderTiles(providers$OpenWeatherMap, group = "OpenWeatherMap") %>%
  # Two different layers
  addCircles(lng = ~LONGITUDE, lat = ~LATITUDE, radius = crimes$PSA, stroke = F, group = "PSA", popup = ~PSA) %>%
  addCircles(data = crimes, lng = ~LONGITUDE, lat = ~LATITUDE,
    fill = F, weight = 3, color = "red", group = "Circle Outline") %>%
  # Layers control
  addLayersControl(
    baseGroups = c("Thunderforest", "OpenWeatherMap"),
    overlayGroups = c("PSA", "Circle Outline"),
    options = layersControlOptions(collapsed = FALSE)
  )
```

